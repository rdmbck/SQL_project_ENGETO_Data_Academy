/*
 * vytvoreni primarni tabulky - rok, kod a nazev odvetvi, prumerna mzda
 * "5958" - kod pro hrubou mzdu 
 */

CREATE OR REPLACE TABLE t_rdm_bck_project_SQL_primary_final AS    
	SELECT 	cp.payroll_year,
		cp.industry_branch_code,
		cpib.name AS industry_branch_name,
		round(avg(cp.value), 0) AS average_industry_wage
FROM czechia_payroll cp
JOIN czechia_payroll_industry_branch cpib -- pripojeni nazvu odvetvi
	ON cp.industry_branch_code = cpib.code 
WHERE value_type_code = "5958" 
	AND cp.industry_branch_code IS NOT NULL -- vyrayeni prumeru za cela odvetvi 
GROUP BY payroll_year, industry_branch_code 
ORDER BY payroll_year
; 


/*
* pripojeni dat z tabulky czechia_price
*/

SELECT 	year(cp.date_from) AS `year`,
		round(avg(cp.value), 2) AS average_price,
		cpc.code,
		cpc.name 
FROM czechia_price cp 
LEFT JOIN czechia_price_category cpc 
	ON cp.category_code = cpc.code 
GROUP BY `year`, cpc.code 
;
